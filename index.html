<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>消防水利マップ</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      width: 100%;
      height: 60vh;
    }
    #form-area {
      padding: 10px;
      background: #f2f2f2;
    }
    input, select, textarea, button {
      margin-top: 5px;
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }
    label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- 入力フォームは script タグの後に置くのが安全 -->
  <div id="form-area">
    <h2>水利情報の入力</h2>
    <form id="waterForm">
      <label>名称：<input type="text" name="name" required /></label><br><br>

      <label>種類：
        <select name="type">
          <option value="消火栓">消火栓</option>
          <option value="水槽">水槽</option>
          <option value="その他">その他</option>
        </select>
      </label><br><br>

      <label>利用可否：
        <select name="usable">
          <option value="○">○</option>
          <option value="×">×</option>
          <option value="要確認">要確認</option>
        </select>
      </label><br><br>

      <label>静水圧（kPa）：<input type="number" name="pressure" /></label><br><br>
      <label>容量（L）：<input type="number" name="capacity" /></label><br><br>

      <label>備考：<br>
        <textarea name="note" rows="3" cols="30"></textarea>
      </label><br><br>

      <label>写真：<input type="file" name="photo" /></label><br><br>

      <label>緯度：<input type="text" name="lat" id="lat" readonly /></label><br><br>
      <label>経度：<input type="text" name="lng" id="lng" readonly /></label><br><br>

      <label>最終更新日：<input type="text" name="date" id="date" readonly /></label><br><br>

      <button type="submit">送信（まだ保存されません）</button>
    </form>
  </div>

  <!-- 地図表示のJS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([34.5202892, 133.9285805], 16); // 深山公園

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    L.marker([34.5202892, 133.9285805])
      .addTo(map)
      .bindPopup("深山公園中心")
      .openPopup();
  </script>
<script>
  // 位置情報と日付の自動入力
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function (position) {
      document.getElementById("lat").value = position.coords.latitude.toFixed(6);
      document.getElementById("lng").value = position.coords.longitude.toFixed(6);
    });
  }

  const today = new Date().toISOString().split("T")[0];
  document.getElementById("date").value = today;

  // フォーム送信イベントを処理
  document.getElementById("waterForm").addEventListener("submit", function (e) {
    e.preventDefault(); // デフォルトの送信を止める

    const formData = new FormData(e.target);
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });

    // ローカルストレージに保存
    const existing = JSON.parse(localStorage.getItem("waterData") || "[]");
    existing.push(data);
    localStorage.setItem("waterData", JSON.stringify(existing));

    alert("保存しました！（ローカル保存）");

    // 入力内容をリセット
    e.target.reset();
    document.getElementById("lat").value = "";
    document.getElementById("lng").value = "";
    document.getElementById("date").value = today;
  });
</script>
  
  
</body>
</html>
